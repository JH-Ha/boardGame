<html>

<head>
    <style>
        #board {
            border: 4px solid pink;
            border-radius: 4px;
            width: 400px;
            height: 400px;
            border-spacing: 0px;
        }

        #board td {
            border: 4px solid pink;
        }

        .clear {
            clear: both;
        }

        #item-1 {
            border-radius: 4px;
            border: 4px solid coral;
            width: 90px;
            height: 90px;
            position: absolute;
            top: 4px;
            left: 4px;
        }

        #content {
            position: relative;
        }
    </style>
    <script>
        class BoardTiles {
            constructor() {
                this.width = 4;
                this.height = 4;
                this.numEmpty = this.width * this.height;
                this.tileArray = null;
                this.init();

            }
            init() {
                this.tileArray = Array();
                

                let i, j;
                for (i =0; i< this.height; i ++){
                    this.tileArray[i] = Array();
                }
                
                for (i = 0; i < this.width; i++) {
                    for (j = 0; j < this.height; j++) {
                        let left = 4 + 98 * i;
                        let top = 4 + 98 * j;
                        let empty = true;
                        this.tileArray[i][j] = new BoardTile(left, top, empty, i, j);
                        this.tileArray[i][j].print();
                    }
                }

            }
            printAll() {
                let i, j;
                console.log(`numEmpty : ${this.numEmpty}`);
                for (i = 0; i < this.width; i++) {
                    for (j = 0; j < this.height; j++) {
                        this.tileArray[i][j].print();
                    }
                }
            }
            getTile(x, y) {
                return this.tileArray[x][y];
            }
            moveRight() {
                let i, j;
                for (j = 0; j < this.height; j++) {
                    for (i = this.width -1; i  >= 1; i--) {
                        if(this.tileArray[i][j].empty == false && this.tileArray[i-1][j].emtpy == false){
                            if(this.tileArray[i][j].value == this.tileArray[i-1][j].value){
                                this.tileArray[i-1][j].empty = true;
                                this.numEmpty ++;
                                this.tileArray[i][j].value *=2;
                                console.log(`add two tiles`);
                            }
                        }

                    }
                }
            }
            createTile(x,y, val){
                this.numEmpty--;
                this.tileArray[x][y].empty = false;
                this.val = val;
            }

        }
        class BoardTile {
            constructor(left, top, empty, x, y) {
                this.left = left; //int
                this.top = top; //int
                this.empty = empty; //boolean
                this.value = 0;
                this.x = x;
                this.y = y;
            }
            print() {
                console.log(`${this.left}, ${this.top}, ${this.empty}, x: ${this.x}, y: ${this.y}`);
            }
        }
        var boardTiles = new BoardTiles();
        boardTiles.createTile(1,1);
        boardTiles.createTile(2,1);
        boardTiles.printAll();

        document.addEventListener("DOMContentLoaded", function () {
            var $item1 = document.getElementById("item-1");
            document.onkeydown = function (event) {
                var x = parseInt($item1.getAttribute('x'));
                var y = parseInt($item1.getAttribute('y'));
                let nextLeft = boardTiles.getTile(x + 1, y).left;
                console.log(`nextLeft ${nextLeft}`);
                console.log(`sytle x ${$item1.getAttribute('x')}`);

                console.log(`random number = ${parseInt(Math.random() * 4)}`);
                console.log(event.keyCode);
                if (event.keyCode == 39) {//오른쪽 키보드
                    boardTiles.moveRight();
                    boardTiles.printAll();
                    var player = $item1.animate([
                        { transform: 'translate(0)' },
                        { transform: `translate(98px,0px)` }
                    ]
                        , 500);
                    player.addEventListener('finish', function () {
                        $item1.style.left = `${nextLeft}px`;
                        $item1.setAttribute('x', x + 1);
                    });
                }
                else if (event.keyCode == 38) {//위쪽 키보드

                }
                else if (event.keyCode == 37) {//왼쪽 키보드

                }
                else if (event.keyCode == 40) {//아래쪽 키보드

                }
            };
        });

    </script>

</head>

<body>

    <div id="content">
        <table id="board">
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </table>
        <div id="item-list">
            <div id="item-1" x="0" y="0"></div>
        </div>
    </div>
</body>

</html>